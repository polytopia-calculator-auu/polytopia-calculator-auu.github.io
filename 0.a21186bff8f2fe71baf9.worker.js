!function(e){var n={};function t(a){if(n[a])return n[a].exports;var s=n[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,t),s.l=!0,s.exports}t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var s in e)t.d(a,s,(function(n){return e[n]}).bind(null,s));return a},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s="1aQb")}({"1aQb":function(e,n,t){"use strict";t.r(n);var a=function(){return(a=Object.assign||function(e){for(var n,t=1,a=arguments.length;t<a;t++)for(var s in n=arguments[t])Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s]);return e}).apply(this,arguments)},s={Warrior:{attack:2,defense:2,hp:10,veteranHp:15,defenseBonus:1.5,wallBonus:4},Rider:{attack:2,defense:1,hp:10,veteranHp:15,defenseBonus:1.5,wallBonus:4},Defender:{attack:1,defense:3,hp:15,veteranHp:20,defenseBonus:1.5,wallBonus:4},Swordsman:{attack:3,defense:3,hp:15,veteranHp:20,defenseBonus:1.5,wallBonus:4},Archer:{attack:2,defense:1,hp:10,veteranHp:15,defenseBonus:1.5,wallBonus:4},Catapult:{attack:4,defense:0,hp:10,veteranHp:15,defenseBonus:0,wallBonus:0},Knight:{attack:3.5,defense:1,hp:10,veteranHp:20,defenseBonus:1.5,wallBonus:4},Giant:{attack:5,defense:4,hp:40,veteranHp:null,defenseBonus:1.5,wallBonus:0},Boat:{attack:1,defense:1,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0},Ship:{attack:2,defense:2,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0},Battleship:{attack:4,defense:3,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0},Amphibian:{attack:2,defense:1,hp:10,veteranHp:15,defenseBonus:1.5,wallBonus:4},Tridention:{attack:3,defense:1,hp:15,veteranHp:20,defenseBonus:1.5,wallBonus:4},Crab:{attack:4,defense:4,hp:40,veteranHp:null,defenseBonus:1.5,wallBonus:4},"Battle Sled":{attack:3,defense:2,hp:15,veteranHp:20,defenseBonus:1.5,wallBonus:4},Polytaur:{attack:3,defense:1,hp:15,veteranHp:null,defenseBonus:1.5,wallBonus:4},Navalon:{attack:4,defense:4,hp:30,veteranHp:null,defenseBonus:1.5,wallBonus:0},"Mind Bender":{attack:0,defense:1,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0},"Ice Fortress":{attack:4,defense:3,hp:20,veteranHp:25,defenseBonus:1.5,wallBonus:4},"Ice Archer":{attack:.1,defense:1,hp:10,veteranHp:15,defenseBonus:1.5,wallBonus:4},"Dragon Egg":{attack:0,defense:2,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:4},"Baby Dragon":{attack:3,defense:3,hp:15,veteranHp:null,defenseBonus:1.5,wallBonus:0},"Fire Dragon":{attack:4,defense:3,hp:20,veteranHp:null,defenseBonus:1.5,wallBonus:0},Mooni:{attack:0,defense:2,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0},"Nature Bunny":{attack:0,defense:1,hp:20,veteranHp:null,defenseBonus:0,wallBonus:0},Gaami:{attack:4,defense:4,hp:30,veteranHp:35,defenseBonus:1.5,wallBonus:4},Shaman:{attack:1,defense:1,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0},Hexapod:{attack:3,defense:1,hp:5,veteranHp:10,defenseBonus:1.5,wallBonus:0},Phychi:{attack:1,defense:1,hp:5,veteranHp:10,defenseBonus:1.5,wallBonus:0},Raychi:{attack:3,defense:2,hp:15,veteranHp:20,defenseBonus:1.5,wallBonus:0},Kiton:{attack:1,defense:3,hp:20,veteranHp:25,defenseBonus:1.5,wallBonus:0},Doomux:{attack:4,defense:2,hp:20,veteranHp:25,defenseBonus:1.5,wallBonus:0},Exida:{attack:3,defense:1,hp:10,veteranHp:25,defenseBonus:1.5,wallBonus:0},Centipede:{attack:4,defense:3,hp:20,veteranHp:null,defenseBonus:1.5,wallBonus:0},Segment:{attack:2,defense:2,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0},Dinghy:{attack:0,defense:.5,hp:5,veteranHp:null,defenseBonus:0,wallBonus:0},Cloak:{attack:0,defense:.5,hp:5,veteranHp:null,defenseBonus:0,wallBonus:0},Dagger:{attack:2,defense:2,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0}},r=["Mooni","Ice Archer","Dragon Egg","Mind Bender","Segment"],u=["Ice Archer","Phychi","Dagger"],l=["Boat","Ship","Battleship"];function o(e){if(!e.unit)return null;var n;if(l.includes(e.unit)){if(!e.carriedUnit)return null;n=s[e.carriedUnit]}else n=s[e.unit];return e.isVeteran&&n.veteranHp?n.veteranHp:n.hp}function d(e){return JSON.parse(JSON.stringify(e))}function f(e){var n=[];if(0===e.length)return[];if(1===e.length)return[e];for(var t=0;t<e.length;t++)for(var a=e[t],s=f(e.slice(0,t).concat(e.slice(t+1))),r=0;r<s.length;r++){var u=[a].concat(s[r]);n.push(u)}return n}addEventListener("message",(function(e){var n,t,l,p,i,c,h,B,v=e.data;postMessage((n=v.attackers,t=v.defenders,c=(l=v.getOptimalResult)?f(n):[n],h=l?f(t):[t],p=h,i=[],c.forEach((function(e){p.forEach((function(n){i.push([e,n])}))})),(B=i).forEach((function(e){var n=function(e,n){var t=[],l=[],d=[],f=0;e.forEach((function(e){var d=n.findIndex((function(e){return e.hp>0}));if("number"!=typeof d||d<0)l.push(e);else{var p,i,c,h,B,v,k,g,w=n[d],H=(h=(c=function(e,n){var t=s[e.unit],a=s[n.unit],l=o(e),d=o(n),f=t.attack;e.isBoosted&&(f+=.5);var p=a.defense,i=1;n.isPoisoned?i=.8:n.withDefenseBonus&&!n.isPoisoned&&(i="withWall"===n.withDefenseBonus?a.wallBonus:a.defenseBonus);var c=f*(e.hp/l).toFixed(16),h=p*i*(n.hp/d).toFixed(16),B=c+h,v=(c/B).toFixed(16)*f*4.5,k=(h/B).toFixed(16)*p*4.5,g=Math.round(v),w=Math.round(k),H=Math.max(n.hp-g,0),m=null;"Fire Dragon"===e.unit&&(m=Math.max(n.hp-Math.floor(g/2),0));var D=e.hp,b=e.freeFromRetaliation||r.includes(n.unit)||u.includes(e.unit);return H>0&&!b?D=Math.max(e.hp-w,0):w=0,{attackDamage:g,defenseDamage:w,defenderNewHp:H,attackerNewHp:D,splashedNewHp:m}}(p=a({},e),i=a({},w))).attackDamage,B=c.defenseDamage,v=c.defenderNewHp,k=c.attackerNewHp,g=c.splashedNewHp,p.origHp=p.hp,p.newHp=k,p.attackDamage=Math.min(h,i.hp-v),i.origHp=i.hp,i.newHp=v,i.splashedNewHp=g,i.defenseDamage=Math.min(B,p.hp-k),{attacker:p,defender:i});f=d,w.preservedHp||(w.preservedHp=w.hp),w.hp=H.defender.newHp,t.push(H)}}));var p=n.slice(f+1),i=t[t.length-1].defender;return i.newHp>0&&d.push(i),{battleResults:t,unusedAttackerUnits:l,untouchedDefenderUnits:p,defenderSurvivors:d}}(d(e[0]),d(e[1])),t=n.battleResults,l=n.unusedAttackerUnits,f=n.untouchedDefenderUnits,p=n.defenderSurvivors,i=a({},function(e){var n=[],t=[],s=[],r=0,u=0;return e.forEach((function(e){e.attacker.newHp>0?n.push(a({},e.attacker)):t.push(a({},e.attacker)),0===e.defender.newHp&&s.push(a({},e.defender)),r+=e.attacker.attackDamage,u+=e.defender.defenseDamage})),{attackerSurvivors:n,attackersKilled:t,defendersKilled:s,totalAttackDamage:r,totalDefenseDamage:u}}(t),{unusedAttackerUnits:l,untouchedDefenderUnits:f,defenderSurvivors:p});e.push(t),e.push(i)})),B.sort((function(e,n){var t=e[3],a=n[3];return a.totalAttackDamage-a.totalDefenseDamage-(t.totalAttackDamage-t.totalDefenseDamage)})).sort((function(e,n){var t=e[3],a=n[3];return a.attackerSurvivors.length+a.unusedAttackerUnits.length+a.defendersKilled.length-(a.defenderSurvivors.length+a.attackersKilled.length+a.untouchedDefenderUnits.length)-(t.attackerSurvivors.length+t.unusedAttackerUnits.length+t.defendersKilled.length-(t.defenderSurvivors.length+t.attackersKilled.length+t.untouchedDefenderUnits.length))})),{battleResults:B[0][2],battleResultStatistics:B[0][3]}))}))}});